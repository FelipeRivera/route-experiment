CREATE TABLE IF NOT EXISTS cities (
  id SERIAL PRIMARY KEY,
  name TEXT UNIQUE NOT NULL
);

CREATE TABLE IF NOT EXISTS nodes (
  city_id INTEGER NOT NULL REFERENCES cities(id) ON DELETE CASCADE,
  osmid BIGINT NOT NULL,
  x DOUBLE PRECISION NOT NULL,
  y DOUBLE PRECISION NOT NULL,
  PRIMARY KEY (city_id, osmid)
);

CREATE TABLE IF NOT EXISTS edges (
  city_id INTEGER NOT NULL REFERENCES cities(id) ON DELETE CASCADE,
  u BIGINT NOT NULL,
  v BIGINT NOT NULL,
  length DOUBLE PRECISION NOT NULL,
  travel_time DOUBLE PRECISION NOT NULL,
  highway TEXT NOT NULL,
  lit BOOLEAN NOT NULL DEFAULT FALSE,
  temp_risk DOUBLE PRECISION NOT NULL,
  security_risk DOUBLE PRECISION NOT NULL,
  PRIMARY KEY (city_id, u, v, length)
);

CREATE INDEX IF NOT EXISTS idx_nodes_city ON nodes(city_id);
CREATE INDEX IF NOT EXISTS idx_edges_city ON edges(city_id);
CREATE INDEX IF NOT EXISTS idx_edges_uv ON edges(city_id, u, v);
